<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Evaluation - LongitudeML Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Evaluation";
        var mkdocs_page_input_path = "evaluation.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> LongitudeML Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../data_pipeline/">Data Pipeline</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../datamodule/">Data Module</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../models/">Models</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../lightning_module/">Lightning Module</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../sklearn_trainer/">Sklearn Trainer</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">Evaluation</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#metric-functions">Metric Functions</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#mi_mse-mi_smape-mi_pearsonr-mi_mae">mi_mse, mi_smape, mi_pearsonr, mi_mae</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#expected-tensor-shapes">Expected Tensor Shapes</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#reduction-modes-reduction-argument">Reduction Modes (reduction argument)</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#example-usage">Example Usage</a>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../logger/">Logger</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../mi_args/">Arguments</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../examples/">Examples</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../utils/">Utils</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">LongitudeML Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Evaluation</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="evaluation-metrics">Evaluation Metrics<a class="headerlink" href="#evaluation-metrics" title="Permanent link">&para;</a></h1>
<p>LongitudeML provides flexible evaluation metrics for regression and classification tasks, supporting sequence masking and multiple aggregation modes.</p>
<h2 id="metric-functions">Metric Functions<a class="headerlink" href="#metric-functions" title="Permanent link">&para;</a></h2>
<h3 id="mi_mse-mi_smape-mi_pearsonr-mi_mae"><code>mi_mse</code>, <code>mi_smape</code>, <code>mi_pearsonr</code>, <code>mi_mae</code><a class="headerlink" href="#mi_mse-mi_smape-mi_pearsonr-mi_mae" title="Permanent link">&para;</a></h3>
<p>These functions compute mean squared error, symmetric mean absolute percentage error, Pearson correlation, and mean absolute error, respectively. They support sequence masking and different reduction (aggregation) modes.</p>
<h3 id="expected-tensor-shapes">Expected Tensor Shapes<a class="headerlink" href="#expected-tensor-shapes" title="Permanent link">&para;</a></h3>
<ul>
<li><code>input</code> (preds): <code>(batch_size, seq_len, num_outcomes)</code></li>
<li><code>target</code>: <code>(batch_size, seq_len, num_outcomes)</code></li>
<li><code>mask</code>: <code>(batch_size, seq_len, num_outcomes)</code> (1=valid, 0=invalid/padded); if not provided, all elements are considered valid</li>
</ul>
<h2 id="reduction-modes-reduction-argument">Reduction Modes (<code>reduction</code> argument)<a class="headerlink" href="#reduction-modes-reduction-argument" title="Permanent link">&para;</a></h2>
<p>The <code>reduction</code> argument controls how metrics are aggregated:</p>
<table>
<thead>
<tr>
<th>Mode</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>within-seq</code></td>
<td>Computes the metric <strong>within each sequence</strong> (e.g., per user or per sample), then averages across all sequences. This is the default and is useful when you want to respect the temporal or grouped structure of your data.</td>
</tr>
<tr>
<td><code>between-seq</code></td>
<td>Computes the metric <strong>between sequence means</strong>: first averages predictions and targets over time within each sequence, then computes the metric on these means across sequences. Use this to evaluate performance at the sequence (e.g., user) level, ignoring within-sequence variation.</td>
</tr>
<tr>
<td><code>flatten</code></td>
<td>Flattens all sequences and time steps into a single vector, then computes the metric globally. Use this for a global, ungrouped assessment.</td>
</tr>
<tr>
<td><code>none</code></td>
<td>Returns the metric for each element (no reduction). Useful for debugging or custom aggregation.</td>
</tr>
</tbody>
</table>
<p><strong>When to use each mode:</strong>
- Use <code>within-seq</code> for most longitudinal or grouped prediction tasks where you care about per-sequence accuracy.
- Use <code>between-seq</code> if your downstream task is to predict sequence-level aggregates (e.g., mean outcome per user).
- Use <code>flatten</code> for a global view, ignoring sequence boundaries.
- Use <code>none</code> for raw, unreduced metrics.</p>
<h2 id="example-usage">Example Usage<a class="headerlink" href="#example-usage" title="Permanent link">&para;</a></h2>
<pre class="highlight"><code class="language-python">from src import mi_mse
# Suppose preds, targets, and mask are torch tensors of shape (batch_size, seq_len, num_outcomes)
# Example: batch_size=32, seq_len=10, num_outcomes=1
mse_within = mi_mse(input=preds, target=targets, mask=mask)  # Default: reduction='within-seq'
mse_flatten = mi_mse(input=preds, target=targets, mask=mask, reduction='flatten')
mse_between = mi_mse(input=preds, target=targets, mask=mask, reduction='between-seq')</code></pre>
<p>See also: <code>examples/ptsd_stop_forecasting/run_PCL_forecast.py</code> for more usage examples. </p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../sklearn_trainer/" class="btn btn-neutral float-left" title="Sklearn Trainer"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../logger/" class="btn btn-neutral float-right" title="Logger">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../sklearn_trainer/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../logger/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
